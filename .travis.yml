language: python
matrix:
  include:
  - os: linux
    sudo: false
    dist: trusty
    python: '2.7'
  - os: linux
    sudo: false
    dist: trusty
    python: '3.4'
  - os: linux
    sudo: false
    dist: trusty
    python: '3.5'
  - os: osx
    language: generic
    env: TRAVIS_PYTHON_VERSION=3.5
before_install:
- wget https://raw.githubusercontent.com/Horta/travis-miniconda/master/install.sh
  -O install.sh
- chmod +x install.sh
- travis_retry bash -x ./install.sh
install:
- export PATH="$HOME/miniconda/bin:$PATH"
- source activate travisci
before_script:
- export PATH="$HOME/miniconda/bin:$PATH"
- source activate travisci
- python setup.py test
script:
- export PATH="$HOME/miniconda/bin:$PATH"
- source activate travisci
- python setup.py sdist
- pip install dist/`ls dist | grep -i -E '\.(gz)$' | head -1`
- pushd /
- python -c "import build_capi; build_capi.test()"
- popd
branches:
  only:
  - master
deploy:
  provider: pypi
  user: dhorta
  password:
    secure: IqDUlgI4G8gKGWnWQQbvaOiXl89ceZscU6JKdaznhYTIzXOg3DJPGwQEduV1AdLpEcX8cE5d7gyY/EQpqQBV7thF+rBC7FitfvXCQJPuCKocgWQyEowH+N+0WTqnChaOrPUUjrYhRvNkr+Zm1n1qaR+wXn78mbeZvfOqVYwNF71UqdWr1AhC8LlUYirpkuHEY4YlqiQfwXXlj90TkEYfS9G6dZoZUqD+ErV86u/rOxMIWNeKxV5Qst3ZbYktS2nzWvaSyFGwPTwcxMdmBEPVOFJ8SpTH8HqXcxDxDkNkS5E0bN9jHiXDKuCqDxNhIKKOP5Mbz0ka9lhnWdwVOvRwcmxXv1E549+9+Qq6QNgMVjj/mgBjy2TxG+hNUWXhJi27HUAHCg8lwMy5Dy9KeM4Oa7/N5nL0EyEcJgLKcjGNAwIBhHe/CzaHs6Qu90Fl7EjP571DqPaizTT7mDNL/JFkWDST8/vvj1h/QN6H5i2d8Z8J/Kyd4OpRKwYhJF9wyH2qr+onaCVXkvofIH/+vveRm+/9y4F73sqeUkRsbC7VBgZ7S0DhuvBeY5BtJDX9HksJnIak2X8MJ8/xqe+x4cEkY6ikma4UrXmbEGl3Fz/gTaKurNsLLTafptPIb3a9sQ0mJYfRU9Zy32S5GwGcj3D9o0P3Tpn+QgoRiOhpybGa7CM=
  on:
    distributions: sdist bdist_wheel
    repo: Horta/build-capi
notifications:
  email: false
