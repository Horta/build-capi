language: python
matrix:
  include:
  - os: linux
    sudo: false
    dist: trusty
    python: '2.7'
  - os: linux
    sudo: false
    dist: trusty
    python: '3.4'
  - os: linux
    sudo: false
    dist: trusty
    python: '3.5'
  - os: osx
    language: generic
    env: TRAVIS_PYTHON_VERSION=3.5
before_install:
- wget https://raw.githubusercontent.com/Horta/travis-miniconda/master/install.sh
  -O install.sh
- chmod +x install.sh
- travis_retry bash -x ./install.sh
install:
- export PATH="$HOME/miniconda/bin:$PATH"
- source activate travisci
before_script:
- export PATH="$HOME/miniconda/bin:$PATH"
- source activate travisci
script:
- export PATH="$HOME/miniconda/bin:$PATH"
- source activate travisci
- python setup.py sdist
- pip install dist/`ls dist | grep -i -E '\.(gz)$' | head -1`
- pushd /
- python -c "import build_capi"
- popd
branches:
  only:
  - master
deploy:
  provider: pypi
  user: dhorta
  password:
    secure: v+bYqmZDxdZzixDga9VbFOcmd0PZ3KdVzvFI/PvTNE0nPMNAswlrA5Gl6hdoGoU3Pu7481jd/OyaInFIrmVQ3cPelFbtIjIOR47NnvbxlCgQwkYjQl0zp6jUWiow6bonHNB0uzpf36vHKyvNY+b0DI0Zj0jjozSXojux7LKbsfm3mZK+0sgdtoIO8PJuLpEoxGsVP2k6zhruM7pngn+I8AO+H0aOohE2yAY1tzqE0yj76pElcfroyMloXPhAJ0ql21QjbM0qEFP8gP++3P0pRsQDBfl4wrsN01PFM/oyPfdDpbu5gkQw7r3DIyEfg5k1MDeCXY4rzecrpQiS0PousCVi9rXGV7efF6OamNDRYoxGwhIg2TqXU4bGjMlS2cFbjEdHqF81tD3+dEOMjxgbA1DCHZqbZh5zvszGI1nqjAoQgu5GPQsy5V56i/n5cRn93dpH8mYnadbRoDez/feRW/MOtEqyBC3YZnc7VCjFynBlpQh+hSxci5gsGVCycVdQZQd677LpYWcQfFJZWrwx1JiTraFT93w7VaGhNePapz55jpFidqaqlhoOGQKHB2vflTbWHEE9tpfEmbioUzS8XCT7YZbsudLQKxl2q97+FrgHrKFIbUdoIf8bbXAUEPBrGu7fR/lRaQ8zQ7colW+9CHV7FejEEQkpA10mURoE+Vk=
  on:
    distributions: sdist bdist_wheel
    repo: Horta/build-capi
notifications:
  email: false
