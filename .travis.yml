language: python
matrix:
  include:
  - os: linux
    sudo: false
    dist: trusty
    python: '2.7'
  - os: linux
    sudo: false
    dist: trusty
    python: '3.4'
  - os: linux
    sudo: false
    dist: trusty
    python: '3.5'
  - os: osx
    language: generic
    env: TRAVIS_PYTHON_VERSION=3.5
cache:
  directories:
  - $HOME/download
before_install:
- wget https://raw.githubusercontent.com/Horta/travis-miniconda/master/install.sh
  -O install.sh
- chmod +x install.sh
- bash -x ./install.sh
install:
- export PATH="$HOME/miniconda/bin:$PATH"
- source activate travisci
- conda install pycparser -y --name travisci
before_script:
- export PATH="$HOME/miniconda/bin:$PATH"
- source activate travisci
- python setup.py test
script:
- export PATH="$HOME/miniconda/bin:$PATH"
- source activate travisci
- python setup.py sdist
- pip install dist/`ls dist | grep -i -E '\.(gz)$' | head -1`
- pushd /
- python -c "import build_capi; build_capi.test()"
- popd
deploy:
  provider: pypi
  skip_cleanup: true
  user: danilo.horta
  on:
    branch: master
  password:
    secure: fSE6pnl7i1bfP4PgRcNvb9cwESdB+2a0Kxd0GB2FTzqNVReCyXkAxiK2fsRd2rIPBrwGZA8CfpaXNHm3ZMqDXHKY35MXsyo58TX4rqC8c+Um/rhQr6OBfGY+hlM7ZwdPaZMIy8MNZahmIcFkjRhqjHPd5A2QIxG4R7qNwGCzMxF1DmtwPPzvWP0DUS3NR3tKku82109pxYN8fAt+FxOD70EQsaMAwecXmZHsFsGJ+oTZPvkGRvqfhRcVnr9wVMkweD07XegDOF4V+QFpH8+1/xiflBW/Rc6v/vdHCY3413Za6pGuc83GJomDBuNiUYCB5T3gVYmKV3TnxqX4oCmIsuHVUFOdV4pBOrWa5cb07NyOEWTR/0LlXVxjpWcpIFMCHQyb7cb+l+YhtnCovp623jM/4zzD/Zhf0Hd/i3FPz07kgo3C/IlGvxf/esUYTT5n9hT9g+ZpifXCzFwl1f5h/eP94q0CQBfNj7xmuPuQs8qEqqk2gbf8lkI4v70OQV5qczDeczBLlaJQNWaTHn6SvoOqVWFylSjehpISATYfrCfL71QoHdHWr2ktvNUdGmH6ORSYeS9ZwEs1UCKH7o/lUld/W/z5mMua/Hax7cGgrBsrY3cWhmdCCRzGfXCrXLpqoFZJ71rK9gTqp/JGAAnw4UJIdH+JIAFT/pzvC0El2Bg=
